<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<h:head>
    <title>[SC]Customers List</title>
</h:head>
<style type="text/css">
    .ui-datatable-header {
        height: 30px
    }
</style>
<f:view>
    <h:body>
        <h:form>
            <ui:insert name="header">
                <ui:include src="/views/template/menuTemplate.xhtml"/>
            </ui:insert>

            <h:form id="mainForm">
                <p:growl id="growl" life="2000"/>

                <p:dataTable id="customers" value="#{customerListBean.getAll()}"
                             var="c" rowKey="#{c.id}"
                             selection="#{customerListBean.selectedItem}" selectionMode="single" reflow="true">
                    <f:facet name="header">
                        Customer list
                        <p:commandButton id="toggler" type="button" style="float:right"
                                         icon="ui-icon-circle-plus"/>
                        <p:columnToggler datasource="customers" trigger="toggler"/>
                    </f:facet>
                    <p:column style="width:35px;text-align: center">
                        <p:commandButton oncomplete="PF('customerDialog').show()"
                                         icon="ui-icon-search" title="View">
                            <f:setPropertyActionListener value="#{c}" target="#{customerListBean.selectedItem}"/>
                        </p:commandButton>
                    </p:column>
                    <p:column headerText="Customer ID">
                        <h:outputText value="#{c.id}"/>
                    </p:column>

                    <p:column headerText="Name">
                        <h:outputText value="#{c.customerName}"/>
                    </p:column>

                    <p:column headerText="Telephone">
                        <h:outputText value="#{c.telephone}"/>
                    </p:column>


                </p:dataTable>

                <p:contextMenu for="customers">
                    <p:menuitem value="Create" action="#{customerBean.loadToCreate()}"/>
                    <p:menuitem value="Edit" action="#{customerBean.load()}">
                        <f:setPropertyActionListener target="#{customerBean.customerId}"
                                                     value="#{customerListBean.selectedItem.id}"/>
                    </p:menuitem>
                    <p:menuitem value="Edit modal" update="customerDetail" onclick="PF('customerDialog').show()"
                                rendered="#{not empty customerListBean.selectedItem}">
                        <f:setPropertyActionListener target="#{customerListBean.selectedItem}" value="#{c}"/>
                    </p:menuitem>

                    <p:menuitem value="Delete" update="customers,growl" action="#{customerListBean.delete}"/>
                </p:contextMenu>

                <p:dialog header="Customer Details" widgetVar="customerDialog" modal="true" resizable="false"
                          focus="btnCancel" appendToBody="false">
                    <p:ajax event="close" update="growl" listener="#{customerListBean.clearSelected}"/>
                    <p:outputPanel id="customerDetail" style="text-align:center;"
                                   rendered="#{not empty customerListBean.selectedItem}">
                        <p:panelGrid columns="2">
                            <h:outputLabel for="customerDetailsId" value="Id:"/>
                            <p:inputText id="customerDetailsId" value="#{customerListBean.selectedItem.id}"
                                         disabled="true"/>

                            <h:outputLabel for="customerDetailsName" value="Name"/>
                            <p:inputText id="customerDetailsName"
                                         value="#{customerListBean.selectedItem.customerName}"/>

                            <h:outputText for="customerDetailsPhone" value="Phone:"/>
                            <p:inputText id="customerDetailsPhone" value="#{customerListBean.selectedItem.telephone}"/>

                            <f:facet name="footer">
                                <p:commandButton id="btnCancel" value="Cancel"
                                                 action="#{customerListBean.clearSelected}"
                                                 onclick="customerDialog.hide(); return false;"/>
                                <p:commandButton id="btnSave" value="Save" action="#{customerListBean.update()}"
                                                 onclick="customerDialog.hide()"
                                                 update="customers"/>
                            </f:facet>

                        </p:panelGrid>
                    </p:outputPanel>
                </p:dialog>
            </h:form>
        </h:form>
    </h:body>
</f:view>
</html>
